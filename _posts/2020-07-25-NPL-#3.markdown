---
layout: post
title:  "å…¥é—¨NLP - #3 æ–‡æœ¬åˆ†ç±» æœºå™¨å­¦ä¹ æ¨¡å‹"
date:   2020-07-25 17:48:09 +0800
categories: NLP
---
ç”¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œæ–‡æœ¬åˆ†ç±»

![img](https://camo.githubusercontent.com/d8e9a12417a2a2a754a874af0ae163bb1bddbb0b/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303230303731343230333232333235332e6a7067)

### 

### æ–‡æœ¬åˆ†ç±»Step1â€”â€”æ–‡æœ¬è¡¨ç¤º

ç±»ä¼¼äºCVä¸­å›¾ç‰‡çœ‹ä½œheight x weight x 3çš„ç‰¹å¾å›¾ï¼Œå‡è®¾æœ‰Nä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰Mä¸ªç‰¹å¾ï¼Œåˆ™æ ·æœ¬çŸ©é˜µä¸ºN x Mã€‚ä½†åœ¨NLPä¸­ï¼Œè¿™ç§æ–¹æ³•ä¸é€‚ç”¨ï¼Œå› ä¸º**æ–‡æœ¬æ˜¯ä¸å®šé•¿çš„**ã€‚å°†æ–‡æœ¬å¤„ç†æˆè®¡ç®—æœºèƒ½è¿ç®—çš„æ•°å­—/å‘é‡çš„æ–¹æ³•å«**è¯åµŒå…¥(Word Embedding)**ã€‚å®ƒå¯ä»¥å°†ä¸å®šé•¿æ–‡æœ¬è½¬åˆ°å®šé•¿ç©ºé—´é‡Œã€‚



#### 1. One-hot

```python
#ç¤ºä¾‹
å¥å­1ï¼šæˆ‘ çˆ± åŒ— äº¬ å¤© å®‰ é—¨
å¥å­2ï¼šæˆ‘ å–œ æ¬¢ ä¸Š æµ·

#å¯¹æ¯ä¸ªå­—tokenize
{
    'æˆ‘': 1, 'çˆ±': 2, 'åŒ—': 3, 'äº¬': 4, 'å¤©': 5,
  'å®‰': 6, 'é—¨': 7, 'å–œ': 8, 'æ¬¢': 9, 'ä¸Š': 10, 'æµ·': 11
}

#å°†æ¯ä¸ªå­—éƒ½å˜æˆlen(å­—æ•°)ç»´çš„ç¨€ç–å‘é‡
æˆ‘ï¼š[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
çˆ±ï¼š[0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]
...
æµ·ï¼š[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
```



#### 2. Bag  of Words / Count vectors / è¯è¢‹

```python
#ç¤ºä¾‹
å¥å­1ï¼šæˆ‘ çˆ± åŒ— äº¬ å¤© å®‰ é—¨
å¥å­2ï¼šæˆ‘ å–œ æ¬¢ ä¸Š æµ·

#ç»Ÿè®¡æ¯ä¸ªå­—å‡ºç°çš„æ¬¡æ•°å¹¶èµ‹å€¼
å¥å­1ï¼šæˆ‘ çˆ± åŒ— äº¬ å¤© å®‰ é—¨
è½¬æ¢ä¸º [1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0]

å¥å­2ï¼šæˆ‘ å–œ æ¬¢ ä¸Š æµ·
è½¬æ¢ä¸º [1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1]

#åœ¨sklearnä¸­çš„å®ç°ï¼ˆCountVectorizerï¼‰ï¼š
from sklearn.feature_extraction.text import CountVectorizer
corpus = [
    'This is the first document.',
    'This document is the second document.',
    'And this is the third one.',
    'Is this the first document?',
]
vectorizer = CountVectorizer()
vectorizer.fit_transform(corpus).toarray()
```



#### 3. N-gram

ä¸2ç±»ä¼¼ï¼Œå°†ç›¸é‚»å•è¯ç»„åˆæˆæ–°çš„å•è¯å¹¶è®¡æ•°

```python
#N=2æ—¶
å¥å­1ï¼šæˆ‘çˆ± çˆ±åŒ— åŒ—äº¬ äº¬å¤© å¤©å®‰ å®‰é—¨
å¥å­2ï¼šæˆ‘å–œ å–œæ¬¢ æ¬¢ä¸Š ä¸Šæµ·
```



#### 4. TF-IDF

[**ä¸€ä¸ªè¯è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°è¶Šå¤š, åŒæ—¶åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°æ¬¡æ•°è¶Šå°‘, è¶Šèƒ½å¤Ÿä»£è¡¨è¯¥æ–‡ç« **](https://zhuanlan.zhihu.com/p/97273457)

```python
#Term Frequencyè¯è¯­é¢‘ç‡
TF(t)= è¯¥è¯è¯­åœ¨å½“å‰æ–‡æ¡£å‡ºç°çš„æ¬¡æ•° / å½“å‰æ–‡æ¡£ä¸­è¯è¯­çš„æ€»æ•°
#Inverse Document Frequencyé€†æ–‡æ¡£é¢‘ç‡
IDF(t)= log_eï¼ˆæ–‡æ¡£æ€»æ•° / å‡ºç°è¯¥è¯è¯­çš„æ–‡æ¡£æ€»æ•°ï¼‰
#æŸä¸€ç‰¹å®šæ–‡ä»¶å†…çš„é«˜è¯è¯­é¢‘ç‡ï¼Œä»¥åŠè¯¥è¯è¯­åœ¨æ•´ä¸ªæ–‡ä»¶é›†åˆä¸­çš„ä½æ–‡ä»¶é¢‘ç‡ï¼Œå¯ä»¥äº§ç”Ÿå‡ºé«˜æƒé‡çš„TF-IDFã€‚å› æ­¤ï¼ŒTF-IDFå€¾å‘äºè¿‡æ»¤æ‰å¸¸è§çš„è¯è¯­ï¼Œä¿ç•™é‡è¦çš„è¯è¯­ï¼Œè¡¨è¾¾ä¸º
TF-IDF=TFÂ·IDF
```



### æ–‡æœ¬åˆ†ç±»step2â€”â€”sklearnçš„æœºå™¨å­¦ä¹ æ¨¡å‹



#### Count Vectors+RidgeClassifier

```python
import pandas as pd

from sklearn.feature_extraction.text import CountVectorizer
from sklearn.linear_model import RidgeClassifier
from sklearn.metrics import f1_score

train_df = pd.read_csv('../input/train_set.csv', sep='\t', nrows=15000)

vectorizer = CountVectorizer(max_features=3000)
train_test = vectorizer.fit_transform(train_df['text'])

clf = RidgeClassifier()
clf.fit(train_test[:10000], train_df['label'].values[:10000])

val_pred = clf.predict(train_test[10000:])
print(f1_score(train_df['label'].values[10000:], val_pred, average='macro'))
# 0.74
```



#### TF-IDF+RidgeClassifier

```python
import pandas as pd

from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import RidgeClassifier
from sklearn.metrics import f1_score

train_df = pd.read_csv('../input/train_set.csv', sep='\t', nrows=15000)

tfidf = TfidfVectorizer(ngram_range=(1,3), max_features=3000)
train_test = tfidf.fit_transform(train_df['text'])

clf = RidgeClassifier()
clf.fit(train_test[:10000], train_df['label'].values[:10000])

val_pred = clf.predict(train_test[10000:])
print(f1_score(train_df['label'].values[10000:], val_pred, average='macro'))
# 0.872
```

æ¯”è¾ƒä¸åŒæ–‡æœ¬åˆ†ç±»ï¼ˆç‰¹å¾æå–ï¼‰æ–¹æ³•å¯¹æœºå™¨å­¦ä¹ çš„å½±å“ï¼ŒTF-IDFæ˜æ˜¾ç»“æœæ›´ä¼˜ã€‚



#### ä½œä¸šï¼š

* å°è¯•æ”¹å˜TF-IDFçš„å‚æ•°ï¼Œå¹¶éªŒè¯ç²¾åº¦(ä»¥ä¸‹æ˜¯ä»…æ”¹å˜å•ä¸€å˜é‡çš„ç»“æœ)

max_features=6000 #0.89  â¬†ï¸

ngram_range=(1,5)  #0.875 â¬†ï¸ğŸ¤

ngram_range=(3,5)  #0.73 â¬‡ï¸

nrows=20000 # 0.877 â¬†ï¸ğŸ¤

* å°è¯•ä½¿ç”¨å…¶ä»–æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå®Œæˆè®­ç»ƒå’ŒéªŒè¯
ï¼Ÿï¼Ÿï¼Ÿ



#### nextâ€¦â€¦æ·±åº¦å­¦ä¹ æ¨¡å‹














